# <a id="enrollmentproject"></a> Апи для сервиса доставок
# Оглавление:
 - [Описание проекта](#description)
 - [Инструкции по запуску проекта](#instruction)
 - [Что внутри](#inside)
 - [Тесты](#Запуск)
 
 #  <a id="description"></a> Описание проекта
 Реализация REST API, имитирующего работу сервиса доставки товаров.
 Для удобной работы с проектом, есть несколько команд через make файл:
 
 - `make lint` - запуск линтера flake8
 - `make test` - запуск тестов через pytest
 - `make local` - запуск приложения локально(не через докер)
 - `make docker` - поднять docker-compose с контейнерами приложения и базой данный посгрес
 - `make db` - поднять базу данных из докер контейнера
 - `make apply_migrations` - накатить миграции

[Наверх](#enrollmentproject)
# <a id="instruction"></a> Инструкции по запуску проекта. 
## Запуск вручную
### Активация виртуального окружения
#### На linux/mac os
```bash
python3 -m venv venv
source venv/bin/activate
```
#### Нa windows
```bash
python -m venv venv
.\venv\Scripts\activate
```

### Установка зависимостей
```bash
pip install -r requirements.txt
```
### Для разработки необходимо дополнительно установить зависимости из `requirements_dev.txt`
```bash
pip install -r requirements_dev.txt
```

### Настройка переменных окружения
Скопируйте файл `config.env` в `.env`, если нужно, отредактируйте значения переменных.
```bash
cp example.env .env
```

### Запуск
Перед запуском надо поднять базу и накатить миграции
```bash
make db
make apply_migrations
make local
```


 ### Запуск через docker-compose
Для запуска проекта нужен установленный `docker` и `docker-compose`. 
Запустить проект можно командой `make docker`
[Наверх](#enrollmentproject)
# <a id="inside"></a> Что внутри
## Документация API
Документация, описанная в формате openapi лежит в поднятом сервисе по обработчику `/docs`

## Структура проекта
```
app - код приложения
├── api
│   └── routes       - ручки и вьюшки проекта
├── db
│   ├── base.py      - файл с настройками алхимии
│   ├── db_config.py - конфиг для доступа к  бд
│   ├── schema.py    - Бд модели алхимии
│   └── utils.py     - Различные утилиты, связанные с бд
├── models
│   ├── dto.py       - dto модели, для передачи данных между слоями апи и базы
│   ├── request_models.py - API модели входящий запросов
│   └── response_models.py - API модели для ответов запросов
├── utils различные утилиты на уровне приложения и взаимодействия с ним
└── main.py          - Точка входа в fastapi приложение
migration - миграции для базы данных
tests - юнит и интеграционные тесты приложения

```
[Наверх](#enrollmentproject)
## <a id="tests"></a> Запуск тестов
На проекте для тестирования используется библиотека pytest. Все тесты происходят на фейковой-тест базе, фикстуры, которые её создают лежат в `tests/conftest.py`
Для запуска тестов нужна установленная библиотека pytest и поднятая база данных
Быстро сделать это можно командами:

 1. `make db`
 2. `make test`

